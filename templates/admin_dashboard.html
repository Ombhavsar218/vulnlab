{% extends 'base.html' %}

{% block title %}Admin Control Panel - Nexus Security Solutions{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto space-y-10 pb-20">
    <!-- Admin Header -->
    <div class="relative overflow-hidden bg-[#0f172a] p-10 rounded-[3rem] border border-slate-800 shadow-2xl">
        <div class="absolute top-0 right-0 w-64 h-64 bg-red-600/5 blur-[100px] rounded-full -mr-32 -mt-32"></div>
        <div class="relative flex flex-col md:flex-row md:items-center justify-between">
            <div>
                <div class="flex items-center space-x-3 mb-2">
                    <div class="w-2 h-2 rounded-full bg-red-500 animate-pulse"></div>
                    <span class="text-[10px] text-red-500 font-black uppercase tracking-[0.3em]">Restricted Access Area</span>
                </div>
                <h1 class="text-4xl font-black text-white flex items-center tracking-tighter">
                    <i class="fas fa-terminal mr-4 text-red-500"></i>
                    Nexus <span class="text-slate-500 ml-2">Admin_Panel</span>
                </h1>
                <p class="text-slate-500 mt-3 font-medium text-sm">Real-time node orchestration and security protocol management.</p>
            </div>
            <div class="mt-6 md:mt-0 flex items-center space-x-4">
                <div class="text-right hidden md:block">
                    <div class="text-[10px] text-slate-500 font-black uppercase tracking-widest mb-1">Session Integrity</div>
                    <div class="text-xs text-green-500 font-bold">VERIFIED_SECURE</div>
                </div>
                <div class="w-12 h-12 rounded-2xl bg-red-500/10 border border-red-500/20 flex items-center justify-center">
                    <i class="fas fa-fingerprint text-red-500"></i>
                </div>
            </div>
        </div>
    </div>

    {% if messages %}
        {% for message in messages %}
            <div class="p-6 rounded-2xl bg-green-500/5 border border-green-500/10 text-green-400 text-xs font-black uppercase tracking-widest flex items-center">
                <i class="fas fa-check-circle mr-3"></i>
                {{ message }}
            </div>
        {% endfor %}
    {% endif %}

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-10">
        <!-- User Management -->
        <div class="lg:col-span-2 space-y-10">
            <div class="bg-[#0f172a] rounded-[2.5rem] border border-slate-800 shadow-xl overflow-hidden group">
                <div class="p-8 border-b border-slate-800/50 flex justify-between items-center bg-slate-900/20">
                    <h2 class="text-xs font-black text-white flex items-center uppercase tracking-[0.2em]">
                        <i class="fas fa-users-cog mr-3 text-blue-500"></i>
                        Identity Orchestration
                    </h2>
                    <button class="px-4 py-2 rounded-xl bg-blue-600/10 border border-blue-600/20 text-[10px] font-black text-blue-400 hover:bg-blue-600 hover:text-white transition uppercase tracking-widest">
                        Provision Node
                    </button>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full text-left">
                        <thead class="bg-[#0a0f1d] text-slate-600 text-[10px] uppercase tracking-[0.2em] font-black">
                            <tr>
                                <th class="px-8 py-5">UID</th>
                                <th class="px-8 py-5">Entity / Credentials</th>
                                <th class="px-8 py-5">Clearance</th>
                                <th class="px-8 py-5">Integrity</th>
                                <th class="px-8 py-5 text-right">Ops</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-slate-800/50">
                            {% for user in admin_users %}
                            <tr class="hover:bg-blue-600/[0.02] transition-colors group/row">
                                <td class="px-8 py-6 text-slate-600 font-mono text-xs">#{{ user.id }}</td>
                                <td class="px-8 py-6">
                                    <div class="text-sm text-slate-200 font-bold">{{ user.username }}</div>
                                    <div class="text-[10px] text-slate-600 font-mono mt-0.5">{{ user.email }}</div>
                                </td>
                                <td class="px-8 py-6">
                                    <span class="px-3 py-1 bg-slate-800/50 rounded-lg text-slate-400 text-[10px] font-black uppercase tracking-widest border border-slate-700/50">{{ user.role }}</span>
                                </td>
                                <td class="px-8 py-6">
                                    <div class="flex items-center">
                                        <div class="w-1.5 h-1.5 rounded-full mr-2 {% if user.status == 'Active' %}bg-green-500 shadow-[0_0_8px_rgba(34,197,94,0.5)]{% else %}bg-yellow-500 shadow-[0_0_8px_rgba(234,179,8,0.5)]{% endif %}"></div>
                                        <span class="text-[10px] font-black uppercase tracking-widest {% if user.status == 'Active' %}text-green-500/80{% else %}text-yellow-500/80{% endif %}">
                                            {{ user.status }}
                                        </span>
                                    </div>
                                </td>
                                <td class="px-8 py-6 text-right">
                                    <button class="w-8 h-8 rounded-lg bg-slate-800/50 flex items-center justify-center text-slate-500 hover:text-white hover:bg-slate-700 transition">
                                        <i class="fas fa-ellipsis-h text-xs"></i>
                                    </button>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Global Logs -->
            <div class="bg-[#0f172a] rounded-[2.5rem] border border-slate-800 shadow-xl overflow-hidden">
                <div class="p-8 border-b border-slate-800/50 flex justify-between items-center bg-slate-900/20">
                    <h2 class="text-xs font-black text-white flex items-center uppercase tracking-[0.2em]">
                        <i class="fas fa-stream mr-3 text-orange-500"></i>
                        Unified Activity Feed
                    </h2>
                    <a href="/logs/" class="text-[10px] font-black text-slate-500 hover:text-white uppercase tracking-widest transition">
                        Full Archive
                    </a>
                </div>
                <div class="p-8 space-y-4 max-h-[500px] overflow-y-auto custom-scrollbar">
                    {% for log in audit_logs %}
                    <div class="group flex items-start space-x-6 p-6 rounded-3xl bg-[#0a0f1d] border border-slate-800/50 hover:border-slate-700 transition-all duration-300">
                        <div class="w-10 h-10 rounded-xl bg-slate-800/50 flex items-center justify-center shrink-0">
                            {% if log.category == 'SECURITY' %}
                                <i class="fas fa-shield-alt text-red-500 text-sm"></i>
                            {% elif log.category == 'USER_MGMT' %}
                                <i class="fas fa-user-shield text-blue-500 text-sm"></i>
                            {% else %}
                                <i class="fas fa-terminal text-slate-500 text-sm"></i>
                            {% endif %}
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="flex justify-between items-center mb-2">
                                <span class="text-[10px] font-mono text-slate-600 uppercase tracking-widest">SEQ_ID: {{ log.id }}</span>
                                <span class="px-2 py-0.5 rounded bg-slate-800 text-[9px] font-mono text-slate-500">{{ log.category }}</span>
                            </div>
                            <p class="text-sm text-slate-400 leading-relaxed">
                                <span class="text-blue-400 font-bold">{{ log.user }}</span> 
                                <span class="text-slate-500">{{ log.action }}</span>
                            </p>
                        </div>
                    </div>
                    {% empty %}
                    <div class="text-center py-12">
                        <i class="fas fa-ghost text-3xl text-slate-800 mb-4 block"></i>
                        <p class="text-xs text-slate-600 font-black uppercase tracking-widest">Zero Signal Detected</p>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>

        <!-- System Settings -->
        <div class="space-y-10">
            <div class="bg-[#0f172a] rounded-[2.5rem] border border-slate-800 shadow-xl p-10 relative overflow-hidden">
                <div class="absolute top-0 right-0 w-32 h-32 bg-purple-600/5 blur-[60px] rounded-full -mr-16 -mt-16"></div>
                <h2 class="text-xs font-black text-white flex items-center mb-10 uppercase tracking-[0.2em] relative">
                    <i class="fas fa-cog mr-3 text-purple-500"></i>
                    Core Protocols
                </h2>
                <form method="POST" class="space-y-8 relative">
                    {% csrf_token %}
                    <input type="hidden" name="update_settings" value="1">
                    
                    {% for key, value in system_settings.items %}
                    <div class="group">
                        <label class="block text-[10px] font-black text-slate-500 uppercase tracking-widest mb-3 group-focus-within:text-purple-400 transition">
                            {{ key }}
                        </label>
                        <div class="relative">
                            <select name="{{ key }}" class="w-full bg-[#0a0f1d] border border-slate-800 rounded-2xl py-4 px-5 text-sm text-slate-300 focus:outline-none focus:border-purple-500 focus:ring-4 focus:ring-purple-500/10 transition appearance-none">
                                <option value="{{ value }}" selected>{{ value }}</option>
                                {% if value == 'Enabled' %}<option value="Disabled">Disabled</option>{% endif %}
                                {% if value == 'Disabled' %}<option value="Enabled">Enabled</option>{% endif %}
                                {% if value == 'OFF' %}<option value="ON">ON</option>{% endif %}
                                {% if value == 'ON' %}<option value="OFF">OFF</option>{% endif %}
                                {% if value == 'Verbose' %}<option value="Minimal">Minimal</option>{% endif %}
                                {% if value == 'Minimal' %}<option value="Verbose">Verbose</option>{% endif %}
                            </select>
                            <div class="absolute right-5 top-1/2 -translate-y-1/2 pointer-events-none text-slate-600">
                                <i class="fas fa-chevron-down text-[10px]"></i>
                            </div>
                        </div>
                    </div>
                    {% endfor %}

                    <button type="submit" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-black py-5 rounded-2xl shadow-xl shadow-purple-500/20 transition transform active:scale-95 uppercase tracking-[0.2em] text-[10px]">
                        Commit Configuration
                    </button>
                </form>
            </div>

            <div class="bg-gradient-to-br from-red-900/10 to-transparent rounded-[2.5rem] border border-red-900/20 p-10">
                <div class="flex items-center space-x-3 mb-6">
                    <i class="fas fa-exclamation-triangle text-red-500"></i>
                    <h3 class="text-xs font-black text-white uppercase tracking-[0.2em]">Emergency Override</h3>
                </div>
                <p class="text-[11px] text-slate-500 mb-8 leading-relaxed font-medium uppercase tracking-wider">Destructive operations will terminate active signals and purge historical data.</p>
                <div class="space-y-4">
                    <button class="group w-full py-4 px-6 rounded-2xl border border-red-500/20 text-red-500/80 hover:bg-red-500 hover:text-white text-[10px] font-black uppercase tracking-widest transition-all flex items-center justify-between">
                        <span>Purge Audit Logs</span>
                        <i class="fas fa-trash-alt opacity-0 group-hover:opacity-100 transition"></i>
                    </button>
                    <button class="group w-full py-4 px-6 rounded-2xl border border-red-500/20 text-red-500/80 hover:bg-red-500 hover:text-white text-[10px] font-black uppercase tracking-widest transition-all flex items-center justify-between">
                        <span>Protocol Reset</span>
                        <i class="fas fa-redo-alt opacity-0 group-hover:opacity-100 transition"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .custom-scrollbar::-webkit-scrollbar { width: 4px; }
    .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
    .custom-scrollbar::-webkit-scrollbar-thumb { background: #1e293b; border-radius: 10px; }
    .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #334155; }
</style>
{% endblock %}
